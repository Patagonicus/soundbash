#!/usr/bin/env bash

get_stream_URLs() {
	wget -O - -- "$1" 2>/dev/null | sed -ne '/window\.SC\.bufferTracks\.push/{s/.*uri":"\([^"]*\)".*streamUrl":"\([^"?]*\).*/\2?\1/;p;}'
}

get_page_count() {
	wget -O - -- "$1" 2>/dev/null | grep -o 'page=[0-9]*' | cut -d= -f 2 | sort -g | tail -n 1
}

count="$(get_page_count "$1")"
if [[ -z "$count" ]]; then
	get_stream_URLs "$1" | head -n 1
else
	if [[ "$count" -gt 10 ]]; then
		count=10
	fi
	for ((i=1;i<=count;i++)); do
		get_stream_URLs "${1}?page=${i}"
	done
fi
